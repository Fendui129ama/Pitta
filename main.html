<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pitta — Trading Aggregator · FireTrader</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Geist+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js"></script>
  <style>
    :root {
      --bg: #0f0f12;
      --bg-panel: #18181c;
      --bg-elev: #222228;
      --border: #2e2e36;
      --accent: #f59e0b;
      --accent-soft: rgba(245, 158, 11, 0.18);
      --green: #10b981;
      --green-soft: rgba(16, 185, 129, 0.15);
      --red: #ef4444;
      --red-soft: rgba(239, 68, 68, 0.15);
      --text: #f4f4f5;
      --text-dim: #a1a1aa;
      --radius: 10px;
      --font: 'Outfit', sans-serif;
      --mono: 'Geist Mono', monospace;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: var(--font);
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      background-image: radial-gradient(ellipse 90% 50% at 50% -15%, rgba(120, 60, 10, 0.25), transparent);
    }
    .wrap { max-width: 1080px; margin: 0 auto; padding: 1.5rem; }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
      padding-bottom: 1.25rem;
      border-bottom: 1px solid var(--border);
      margin-bottom: 1.25rem;
    }
    .logo { font-weight: 700; font-size: 1.65rem; color: var(--accent); letter-spacing: 0.02em; }
    .tagline { font-size: 0.8rem; color: var(--text-dim); margin-top: 0.2rem; }
    .header-right { display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap; }
    input.contract {
      width: 260px;
      padding: 0.5rem 0.75rem;
      font-family: var(--mono);
      font-size: 0.8rem;
      background: var(--bg-panel);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: var(--radius);
    }
    input.contract:focus { outline: none; border-color: var(--accent); }
    .addr { font-family: var(--mono); font-size: 0.8rem; color: var(--green); max-width: 140px; overflow: hidden; text-overflow: ellipsis; }
    .btn {
      font-family: var(--font);
      font-weight: 500;
      padding: 0.5rem 1rem;
      border: 1px solid var(--border);
      background: var(--bg-panel);
      color: var(--text);
      cursor: pointer;
      border-radius: var(--radius);
      font-size: 0.9rem;
    }
    .btn:hover { border-color: var(--accent); }
    .btn.primary { background: var(--accent); border-color: var(--accent); color: #0f0f12; }
    .btn.primary:hover { filter: brightness(1.1); }
    .btn.small { padding: 0.35rem 0.7rem; font-size: 0.85rem; }
    .tabs { display: flex; flex-wrap: wrap; gap: 0.3rem; margin-bottom: 1.25rem; }
    .tab {
      padding: 0.55rem 1rem;
      background: var(--bg-panel);
      border: 1px solid var(--border);
      color: var(--text-dim);
      cursor: pointer;
      border-radius: var(--radius);
      font-size: 0.9rem;
    }
    .tab:hover { color: var(--text); }
    .tab.active { border-color: var(--accent); color: var(--accent); background: var(--accent-soft); }
    .panel { display: none; }
    .panel.visible { display: block; }
    .stats {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1rem;
      padding: 0.85rem 1rem;
      background: var(--bg-panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 0.85rem;
    }
    .stats span { color: var(--text-dim); }
    .stats strong { color: var(--accent); margin-right: 0.25rem; }
    .card {
      background: var(--bg-panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.15rem;
      margin-bottom: 1rem;
    }
    .card h3 { font-size: 1rem; margin-bottom: 0.75rem; color: var(--accent); }
    .card h4 { font-size: 0.9rem; margin: 0.75rem 0 0.4rem; color: var(--text-dim); }
    label { display: block; font-size: 0.8rem; color: var(--text-dim); margin-bottom: 0.25rem; }
    .input, textarea, select {
      width: 100%;
      padding: 0.5rem 0.75rem;
      font-family: var(--mono);
      font-size: 0.85rem;
      background: var(--bg);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: var(--radius);
      margin-bottom: 0.6rem;
    }
    .input:focus, textarea:focus, select:focus { outline: none; border-color: var(--accent); }
    textarea { min-height: 80px; resize: vertical; }
    .row { display: flex; gap: 1rem; flex-wrap: wrap; }
    .row .card { flex: 1; min-width: 260px; }
    .actions { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.75rem; }
    .msg { padding: 0.55rem 0.75rem; border-radius: var(--radius); margin-top: 0.5rem; font-size: 0.85rem; }
    .msg.ok { background: var(--green-soft); border: 1px solid var(--green); color: var(--green); }
    .msg.err { background: var(--red-soft); border: 1px solid var(--red); color: var(--red); }
    .msg.info { background: var(--accent-soft); border: 1px solid var(--accent); color: var(--accent); }
    .list { list-style: none; }
    .list li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 0.5rem;
      padding: 0.6rem 0;
      border-bottom: 1px solid var(--border);
      font-size: 0.9rem;
    }
    .list li:last-child { border-bottom: none; }
    .list .mono { font-family: var(--mono); font-size: 0.8rem; color: var(--text-dim); }
    .help-box { background: var(--bg-elev); border: 1px solid var(--border); border-radius: var(--radius); padding: 0.85rem; font-size: 0.85rem; color: var(--text-dim); margin-bottom: 1rem; }
    .help-box strong { color: var(--accent); }
    .empty-state { text-align: center; padding: 2rem; color: var(--text-dim); font-size: 0.95rem; }
    pre { font-family: var(--mono); }
    code { font-family: var(--mono); font-size: 0.8em; background: var(--bg-elev); padding: 0.15rem 0.35rem; border-radius: 4px; color: var(--accent); }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    @media (max-width: 768px) { .grid-2 { grid-template-columns: 1fr; } }
    .card-note { border-left: 3px solid var(--accent); }
    .card-warning { border-left: 3px solid var(--red); }
    .btn:focus-visible, .tab:focus-visible, input:focus-visible, textarea:focus-visible, select:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
    @media print {
      .stats, .tabs, .btn, .header-right input.contract, .header-right .addr, #wallet-addr, [id^="btn-"] { display: none !important; }
      body { background: #fff; color: #111; }
      .card { border-color: #ccc; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="logo">Pitta</div>
        <p class="tagline">Trading aggregator · FireTrader</p>
      </div>
      <div class="header-right">
        <input type="text" id="contract-address" class="contract" placeholder="FireTrader contract 0x..." />
        <button type="button" class="btn small" id="btn-attach">Attach</button>
        <span class="addr" id="wallet-addr">—</span>
        <button type="button" class="btn primary" id="btn-connect">Connect wallet</button>
      </div>
    </header>

    <div class="stats" id="stats-bar" style="display:none;">
      <span>Venues: <strong id="stat-venues">0</strong></span>
      <span>Fee: <strong id="stat-fee">—</strong> bps</span>
      <span>Paused: <strong id="stat-paused">—</strong></span>
    </div>
    <p class="help-box" id="stats-desc" style="display:none; margin-top:0; margin-bottom:1rem;">Stats bar shows total registered venues, current fee in basis points, and whether the aggregator is paused. Visible after attaching a contract.</p>

    <div class="tabs">
      <button type="button" class="tab active" data-tab="venues">Venues</button>
      <button type="button" class="tab" data-tab="route">Route trade</button>
      <button type="button" class="tab" data-tab="lookup">Lookup route</button>
      <button type="button" class="tab" data-tab="fees">Fees</button>
      <button type="button" class="tab" data-tab="config">Config</button>
    </div>

    <div id="panel-venues" class="panel visible">
      <div class="card" style="margin-bottom:1rem;">
        <p style="font-size:0.9rem; color:var(--text-dim); margin-bottom:0.5rem;">Pitta is the web interface for <strong>FireTrader</strong>, a trading aggregator. Register venues (target contracts), then route trades by sending ETH and calldata. Fees are split between treasury and fee collector.</p>
        <p style="font-size:0.85rem; color:var(--text-dim); margin-bottom:0.5rem;"><strong>Venues</strong>: list all venues, register one (owner), toggle active (owner), batch register (owner), load active venue IDs. <strong>Route trade</strong>: choose venue, set min out, paste payload hex, send ETH. <strong>Lookup</strong>: route by ID or venue by ID. <strong>Fees</strong>: view accumulated fees, sweep as treasury or fee collector. <strong>Config</strong>: config, constants, about, glossary, aggregate stats, quick reference, caveats, FAQ.</p>
        <h4>Quick start</h4>
        <p style="font-size:0.85rem; color:var(--text-dim);">1. Paste the FireTrader contract address and click Attach. 2. Click Connect wallet and approve the connection. 3. In Venues, check that your target venue exists and is active. 4. In Route trade, enter venue ID, min out (or 0), payload hex, and value in wei. 5. Click Estimate fee then Route trade and confirm in your wallet.</p>
      </div>
      <div class="card">
        <h3>Registered venues</h3>
        <div class="help-box">Venues are target contracts (e.g. DEX or order book). Only owner can register. Route trades send (value − fee) to the venue with your payload. Inactive venues are hidden from routing.</div>
        <div class="actions">
          <button type="button" class="btn small" id="btn-refresh-venues">Refresh</button>
        </div>
        <ul class="list" id="venues-list"></ul>
        <div class="empty-state" id="venues-empty" style="display:none;">No venues or contract not attached.</div>
        <h4 style="margin-top:1rem;">Active venue IDs only</h4>
        <p style="font-size:0.85rem; color:var(--text-dim); margin-bottom:0.5rem;">List of venue IDs that are currently active (can be used for routing).</p>
        <div class="actions">
          <button type="button" class="btn small" id="btn-active-venues">Load active venue IDs</button>
        </div>
        <pre id="active-venues-out" style="font-size:0.85rem; font-family:var(--mono); color:var(--text-dim); margin-top:0.5rem;"></pre>
      </div>
      <div class="row">
        <div class="card">
          <h4>Register venue (owner only)</h4>
          <label>Target contract address</label>
          <input type="text" id="venue-target" class="input" placeholder="0x..." />
          <label>Label hash (bytes32 hex, or leave empty for 0x0)</label>
          <input type="text" id="venue-label" class="input" placeholder="0x..." />
          <div class="actions">
            <button type="button" class="btn primary" id="btn-register-venue">Register</button>
          </div>
          <div id="register-msg"></div>
        </div>
        <div class="card">
          <h4>Toggle venue active (owner only)</h4>
          <p style="font-size:0.85rem; color:var(--text-dim); margin-bottom:0.5rem;">Disable a venue without removing it. Inactive venues cannot be used for routing.</p>
          <label>Venue ID</label>
          <input type="number" id="toggle-venue-id" class="input" min="1" placeholder="1" />
          <label>Active (checked = active)</label>
          <input type="checkbox" id="toggle-venue-active" checked />
          <div class="actions">
            <button type="button" class="btn small" id="btn-toggle-venue">Set active state</button>
          </div>
          <div id="toggle-msg"></div>
        </div>
      </div>
      <div class="card">
        <h4>Batch register venues (owner only)</h4>
        <p style="font-size:0.85rem; color:var(--text-dim); margin-bottom:0.5rem;">Register multiple venues in one tx. Enter target addresses (one per line or comma-separated). Labels can be one per line or comma-separated; if you provide fewer labels than targets, missing labels are set to 0x0. Max 16 venues per batch. Useful when onboarding several DEX or order-book contracts at once.</p>
        <label>Target addresses (one per line or comma-separated)</label>
        <textarea id="batch-targets" class="input" rows="3" placeholder="0x...&#10;0x..."></textarea>
        <label>Label hashes (one per line or comma; 0x0 or empty for zero)</label>
        <textarea id="batch-labels" class="input" rows="2" placeholder="0x... or empty"></textarea>
        <div class="actions">
          <button type="button" class="btn primary" id="btn-batch-register">Batch register</button>
        </div>
        <div id="batch-register-msg"></div>
      </div>
    </div>

    <div id="panel-route" class="panel">
      <div class="help-box" style="margin-bottom:1rem;">
        <strong>Before you route:</strong> Attach the FireTrader contract and connect your wallet. Confirm the venue is active (Venues tab). Build the payload for the venue (e.g. swap calldata). Enter value in wei; use Estimate fee to see fee and net. Min out is optional; use 0 to skip the check.
      </div>
      <div class="row">
        <div class="card">
          <h3>Route trade</h3>
          <div class="help-box">Send ETH to FireTrader; fee is deducted and the rest is forwarded to the venue with your calldata. Payload is the hex-encoded call to the venue (e.g. swap). Min out is optional (0 = no check).</div>
          <label>Venue ID</label>
          <input type="number" id="route-venue-id" class="input" min="1" placeholder="1" />
          <label>Min amount out (wei; 0 = no check)</label>
          <input type="text" id="route-min-out" class="input" value="0" placeholder="0" />
          <label>Payload (hex calldata for venue)</label>
          <input type="text" id="route-payload" class="input" placeholder="0x..." />
          <label>ETH to send (wei or ETH)</label>
          <input type="text" id="route-value" class="input" placeholder="0.01" />
          <div class="actions">
            <button type="button" class="btn primary" id="btn-route">Route trade</button>
            <button type="button" class="btn small" id="btn-estimate-fee">Estimate fee</button>
          </div>
          <div id="route-msg"></div>
        </div>
        <div class="card">
          <h4>Fee &amp; net</h4>
          <p style="font-size:0.85rem; color:var(--text-dim); margin-bottom:0.5rem;">Fee is (value × feeBps / 10000). Half to treasury, half to fee collector. Net to venue = value − fee.</p>
          <div id="estimate-out" style="font-family:var(--mono); font-size:0.85rem; color:var(--text-dim);"></div>
        </div>
      </div>
      <div class="card">
        <h4>Payload format</h4>
        <p style="font-size:0.85rem; color:var(--text-dim); margin-bottom:0.5rem;">Payload is the hex-encoded calldata sent to the venue contract. For a simple swap you might use the venue's swap function selector (4 bytes) plus ABI-encoded arguments. Example: <code>0x</code> + selector + abi.encode(args). The venue receives (value − fee) as msg.value. If the venue returns a uint256 it is used as amount out and checked against minOutWei when minOutWei &gt; 0.</p>
      </div>
      <div class="card">
        <h4>Route flow</h4>
        <p style="font-size:0.85rem; color:var(--text-dim); margin-bottom:0.5rem;">1. User sends ETH + payload to FireTrader.routeTrade(venueId, minOut, payload). 2. Contract computes fee = value × feeBps / 10000 and splits it (treasury + fee collector). 3. Contract forwards (value − fee) to the venue via a low-level call with payload. 4. Venue executes (e.g. swap); optional return value is treated as amount out. 5. If minOut &gt; 0 and venue returns a value, contract reverts when return &lt; minOut. 6. Route ID and snapshot are stored and emitted.</p>
      </div>
      <div class="card">
        <h4>Example: building a payload</h4>
        <p style="font-size:0.85rem; color:var(--text-dim); margin-bottom:0.5rem;">Suppose the venue has a function <code>swapExactEthForTokens(uint256 minOut) returns (uint256 amountOut)</code>. The selector is the first 4 bytes of keccak256("swapExactEthForTokens(uint256)"). You would ABI-encode minOut and prepend the selector to get the payload. In JavaScript with ethers: <code>const iface = new ethers.Interface(["function swapExactEthForTokens(uint256) returns (uint256)"]); const payload = iface.encodeFunctionData("swapExactEthForTokens", [minOut]);</code>. Paste the resulting hex (0x...) into the Payload field. The venue will receive (your value − fee) as msg.value.</p>
      </div>
    </div>

    <div id="panel-lookup" class="panel">
      <div class="help-box" style="margin-bottom:1rem;">
        Route IDs are bytes32 values emitted in the TradeRouted event when you call routeTrade. Venue IDs are sequential (1, 2, 3, …) assigned when venues are registered. Use a block explorer to find the routeId from your transaction logs if you did not save it.
      </div>
      <div class="grid-2">
        <div class="card">
          <h3>Lookup route by ID</h3>
          <p style="font-size:0.85rem; color:var(--text-dim); margin-bottom:0.5rem;">Route ID is emitted in TradeRouted. Enter the bytes32 hex (0x + 64 hex chars) to see user, venue, amounts, fee.</p>
          <label>Route ID (bytes32 hex)</label>
          <input type="text" id="lookup-route-id" class="input" placeholder="0x..." />
          <div class="actions">
            <button type="button" class="btn small" id="btn-lookup-route">Lookup</button>
          </div>
          <pre id="lookup-route-out" style="font-size:0.85rem; font-family:var(--mono); color:var(--text-dim); margin-top:0.75rem; white-space:pre-wrap; word-break:break-all;"></pre>
        </div>
        <div class="card">
          <h4>Lookup venue by ID</h4>
          <p style="font-size:0.85rem; color:var(--text-dim); margin-bottom:0.5rem;">Get full venue view: target, label, registered block, active, trade count, volume.</p>
          <label>Venue ID</label>
          <input type="number" id="lookup-venue-id" class="input" min="1" placeholder="1" />
          <div class="actions">
            <button type="button" class="btn small" id="btn-lookup-venue">Lookup venue</button>
          </div>
          <pre id="lookup-venue-out" style="font-size:0.85rem; font-family:var(--mono); color:var(--text-dim); margin-top:0.75rem; white-space:pre-wrap; word-break:break-all;"></pre>
        </div>
      </div>
    </div>

    <div id="panel-fees" class="panel">
      <div class="card" style="margin-bottom:1rem;">
        <p style="font-size:0.85rem; color:var(--text-dim); margin-bottom:0.5rem;">Every routed trade pays a fee (value × feeBps / 10000). Half is credited to the treasury balance and half to the fee collector. Only those two addresses can sweep their respective accumulated balance. Load fees to see current totals.</p>
        <p style="font-size:0.85rem; color:var(--text-dim);"><strong>Who can sweep:</strong> sweepTreasuryFees() can only be called by the treasury address; sweepCollectorFees() only by the fee collector. If you are not one of these, the buttons will revert on-chain. Connect with the correct wallet to sweep.</p>
      </div>
      <div class="row">
        <div class="card">
          <h3>Accumulated fees</h3>
          <p style="font-size:0.85rem; color:var(--text-dim); margin-bottom:0.5rem;">Treasury and fee collector each accumulate half of the route fee. Sweep to withdraw to your wallet (must be treasury or fee collector).</p>
          <div class="actions">
            <button type="button" class="btn small" id="btn-load-fees">Load fees</button>
          </div>
          <pre id="fees-detail" style="font-size:0.85rem; font-family:var(--mono); color:var(--text-dim); margin-top:0.75rem; white-space:pre-wrap; word-break:break-all;"></pre>
        </div>
        <div class="card">
          <h4>Sweep (treasury / fee collector only)</h4>
          <p style="font-size:0.85rem; color:var(--text-dim); margin-bottom:0.5rem;">Connect as treasury or fee collector address and click the matching button.</p>
          <div class="actions">
            <button type="button" class="btn small" id="btn-sweep-treasury">Sweep treasury</button>
            <button type="button" class="btn small" id="btn-sweep-collector">Sweep fee collector</button>
          </div>
          <div id="sweep-msg"></div>
        </div>
      </div>
    </div>

    <div id="panel-config" class="panel">
      <div class="card">
        <h3>Contract config</h3>
        <p style="margin-bottom:0.5rem; font-size:0.85rem; color:var(--text-dim);">FireTrader immutable addresses and runtime config. Treasury and fee collector are set at deploy and cannot change. Fee bps and paused state can be updated by owner and aggregator keeper respectively.</p>
        <p style="margin-bottom:0.75rem; font-size:0.8rem; color:var(--text-dim);">Load config shows: treasury_, feeCollector_, aggregatorKeeper_, feeBps_, deployedBlock_, aggregatorPaused_.</p>
        <div class="actions">
          <button type="button" class="btn small" id="btn-load-config">Load config</button>
          <button type="button" class="btn small" id="btn-load-constants">Load constants</button>
        </div>
        <pre id="config-detail" style="font-size:0.8rem; font-family:var(--mono); color:var(--text-dim); white-space:pre-wrap; word-break:break-all; margin-top:0.75rem;"></pre>
      </div>
      <div class="card">
        <h4>Contract constants</h4>
        <pre id="constants-out" style="font-size:0.85rem; font-family:var(--mono); color:var(--text-dim); margin-top:0.5rem;"></pre>
